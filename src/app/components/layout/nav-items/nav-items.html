<nav class="flex-1 mb-10 text-sm">
  @for (menu of menus(); track menu.path) {
    @if (!menu.children?.length) {
      <a
        [routerLink]="menu.path"
        class="flex items-center gap-2 px-4 py-2 hover:bg-primary-hover cursor-pointer"
      >
        <ng-icon [name]="findIcon(menu.name)"></ng-icon>
        @if (expanded) {
          <span class="whitespace-nowrap">{{ menu.name }}</span>
        }
      </a>
    }
    @else {
      <!-- Parent item (relative container for floating submenu) -->
      <div class="relative group">
        <div
          (click)="toggle(menu.path)"
          class="flex items-center gap-2 px-4 py-2 font-semibold hover:bg-primary-hover cursor-pointer select-none"
        >
          <ng-icon [name]="findIcon(menu.name)"></ng-icon>
          @if (expanded) {
            <span class="whitespace-nowrap">{{ menu.name }}</span>
            <ng-icon
              name="bootstrapChevronDown"
              class="ml-auto transition-transform duration-200"
              [class.rotate-180]="isOpen(menu.path)"
            ></ng-icon>
          }
        </div>

        <!-- Expanded mode: inline collapsible list (unchanged) -->
        @if (expanded) {
          <div
            class="overflow-hidden transition-all duration-200"
            [ngClass]="[
              isOpen(menu.path) ? 'max-h-[800px]' : 'max-h-0'
            ]"
          >
            @for (child of (menu.children ?? []); track child.path) {
              <a
                [routerLink]="[menu.path, child.path]"
                class="flex items-center gap-2 px-8 py-1.5 hover:bg-primary-hover"
              >
                <ng-icon [name]="findIcon(child.name)"></ng-icon>
                <span class="whitespace-nowrap">{{ child.name }}</span>
              </a>
            }
          </div>
        }

        <!-- Collapsed mode: FLOATING submenu (absolute) -->
        @if (!expanded) {
          <div class="fixed left-16 w-48 bg-primary text-on-primary border border-gray-200 rounded shadow-lg z-[9999]
       opacity-0 invisible group-hover:opacity-100 group-hover:visible
       transition-all duration-150"
       [ngStyle]="{ transform: 'translateY(-' + (100 / (menu.children?.length || 1)) + '%)' }">
            @for (child of (menu.children ?? []); track child.path) {
              <a
                [routerLink]="[menu.path, child.path]"
                class="flex items-center gap-2 px-4 py-2 hover:bg-primary-hover"
              >
                <ng-icon [name]="findIcon(child.name)"></ng-icon>
                <span class="whitespace-nowrap">{{ child.name }}</span>
              </a>
            }
          </div>
        }
      </div>
    }
  }
</nav>
